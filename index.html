<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Undercover - Final Deluxe!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="title-header">
            <h1>UC HAMDI'S VERSION</h1>
            <div class="header-controls">
                <button id="show-guide-btn" title="Cara Bermain"><i class="fas fa-question"></i></button>
                <button id="toggle-music-btn" title="Putar/Hentikan Musik"><i class="fas fa-music"></i></button>
                <button id="open-music-settings-btn" title="Pengaturan Musik"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div id="initial-config-section">
            <h2><i class="fas fa-cogs"></i> Pengaturan Awal Permainan</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="total-players-config"><i class="fas fa-users"></i> Total Pemain:</label>
                    <input type="number" id="total-players-config" min="3" max="15" value="3">
                </div>
                <div class="config-item">
                    <label for="civilians-config"><i class="fas fa-user-shield" id="icon-civilian"></i> Civilian:</label>
                    <input type="number" id="civilians-config" min="0" value="1">
                </div>
                <div class="config-item">
                    <label for="undercovers-config"><i class="fas fa-user-secret" id="icon-undercover"></i> Undercover:</label>
                    <input type="number" id="undercovers-config" min="0" value="1">
                </div>
                <div class="config-item">
                    <label for="mrwhites-config"><i class="fas fa-user-tie" id="icon-mrwhite"></i> Mr. White:</label>
                    <input type="number" id="mrwhites-config" min="0" value="1">
                </div>
            </div>
            <button id="proceed-to-card-distribution-btn" class="btn-primary"><i class="fas fa-arrow-right"></i> Lanjut ke Pembagian Kartu</button>
            <p id="config-error" class="error-message hidden"></p>
        </div>

        <div id="player-name-input-section" class="hidden">
            <h2 id="player-name-input-title"><i class="fas fa-user-plus"></i> Masukkan Nama Pemain X</h2>
            <label for="current-player-name-input">Nama Anda:</label>
            <input type="text" id="current-player-name-input" placeholder="Nama Pemain">
            <button id="submit-name-and-draw-card-btn" class="btn-primary"><i class="fas fa-save"></i> Simpan Nama & Ambil Kartu</button>
        </div>

        <div id="card-reveal-modal" class="modal hidden">
            <div class="modal-content card-modal-content">
                <h3 id="card-reveal-popup-title">Ambil Kartu Anda, [Nama Pemain]!</h3>
                <div class="card-scene">
                    <div class="card" id="role-card">
                        <div class="card-face card-back">
                            <div class="card-back-design">
                                <span>?</span>
                            </div>
                            <p><i class="fas fa-hand-pointer"></i> SENTUH KARTU UNTUK MEMBALIK</p>
                        </div>
                        <div class="card-face card-front">
                            <h4 class="card-role-title">Peran Anda:</h4>
                            <p id="card-player-role" class="card-role-text"></p>
                            <h4 class="card-word-title">Kata Rahasia:</h4>
                            <p id="card-player-word" class="card-word-text"></p>
                        </div>
                    </div>
                </div>
                <button id="hide-card-and-proceed-btn" class="hidden btn-primary"><i class="fas fa-eye-slash"></i> Sembunyikan & Lanjut</button>
                <button id="close-peek-view-btn" class="hidden btn-secondary"><i class="fas fa-arrow-left"></i> Kembali ke Permainan</button>
            </div>
        </div>

        <div id="game-section" class="hidden">
            <h2><i class="fas fa-users"></i> Pemain Aktif Babak Ini:</h2>
            <div class="peek-card-container">
                <button id="peek-card-btn" class="btn-secondary"><i class="fas fa-eye"></i> Intip Kartu Pribadi</button>
            </div>
            <ul id="active-player-list" class="player-avatar-grid"></ul>
            <p id="debug-civilian-word" style="display:none;">Kata Civilian: <em id="civilian-word-display">(Debug)</em></p>

            <div id="voting-phase">
                <h3><i class="fas fa-vote-yea"></i> Konfirmasi Eliminasi</h3>
                <p>Pemain yang dipilih untuk dieliminasi: <strong id="player-to-eliminate-display">Belum ada</strong></p>
                <button id="confirm-elimination-btn" disabled><i class="fas fa-gavel"></i> Konfirmasi Eliminasi</button>
            </div>

            <div id="elimination-result-popup" class="modal hidden">
                <div class="modal-content elimination-popup-content">
                    <h3 id="eliminated-player-info"></h3>
                    <div id="truth-or-dare-section">
                        <p>Silakan pilih hukuman untuk yang tereliminasi:</p>
                        <button id="truth-btn"><i class="fas fa-check-circle"></i> Truth</button>
                        <button id="dare-btn"><i class="fas fa-fire"></i> Dare</button>
                        <div id="penalty-display" class="hidden">
                            <p id="penalty-text"></p>
                        </div>
                    </div>
                    <button id="close-elimination-popup-btn" class="hidden"><i class="fas fa-arrow-right"></i> Lanjut</button>
                </div>
            </div>

            <div id="mr-white-guess-section" class="hidden">
                <h3><i class="fas fa-user-secret"></i> Mr. White Teridentifikasi!</h3>
                <p><strong id="mr-white-name-guess"></strong>, Anda punya satu kesempatan untuk menebak kata rahasia Civilian:</p>
                <input type="text" id="mr-white-word-guess-input" placeholder="Ketik tebakan kata Civilian">
                <button id="submit-mr-white-guess-btn"><i class="fas fa-paper-plane"></i> Kirim Tebakan</button>
            </div>
        </div>
        
        <div id="how-to-play-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-popup-btn">&times;</span>
                <h2><i class="fas fa-book-open"></i> Cara Bermain Undercover <i class="fas fa-book-open"></i></h2>
                <div class="guide-content">
                    <h3>Tujuan Permainan</h3>
                    <p>Ini adalah permainan deduksi sosial. Setiap pemain memiliki peran dan kata rahasia, kecuali Mr. White.</p>
                    <ul>
                        <li><strong class="role-civilian">Tim Civilian:</strong> Tujuanmu adalah menemukan dan mengeliminasi semua Undercover & Mr. White.</li>
                        <li><strong class="role-undercover">Tim Undercover:</strong> Tujuanmu adalah menyamar, berpura-pura menjadi Civilian, dan bertahan hingga akhir.</li>
                        <li><strong class="role-mrwhite">Mr. White:</strong> Kamu tidak tahu kata apapun. Tujuanmu adalah menyamar, mencari tahu kata rahasia Civilian, dan bertahan.</li>
                    </ul>

                    <h3>Alur Permainan</h3>
                    <ol>
                        <li><strong>Pengaturan:</strong> Tentukan jumlah total pemain dan komposisi peran (Civilian, Undercover, Mr. White). Pastikan jumlah peran sama dengan total pemain.</li>
                        <li><strong>Pembagian Peran:</strong> Setiap pemain memasukkan nama dan mengambil kartu secara rahasia. JANGAN tunjukkan peran atau katamu kepada siapa pun!</li>
                        <li><strong>Diskusi:</strong> Secara bergiliran, setiap pemain memberikan <strong>satu kata</strong> untuk mendeskripsikan kata rahasianya.
                            <ul>
                                <li><em>Tips Civilian:</em> Beri petunjuk yang jelas untuk sesama Civilian, tapi jangan terlalu kentara agar tidak mudah ditebak oleh Mr. White.</li>
                                <li><em>Tips Undercover:</em> Katamu mirip dengan Civilian. Beri petunjuk yang ambigu agar tidak dicurigai.</li>
                                <li><em>Tips Mr. White:</em> Dengarkan baik-baik petunjuk orang lain. Berpura-pura dan berikan kata yang relevan seolah-olah kamu tahu katanya.</li>
                            </ul>
                        </li>
                        <li><strong>Voting & Eliminasi:</strong> Setelah semua memberi petunjuk, diskusikan siapa yang paling mencurigakan. Lakukan voting untuk mengeliminasi satu pemain.</li>
                        <li><strong>Hukuman:</strong> Pemain yang tereliminasi (dan tidak menang) akan mendapat hukuman Truth or Dare.</li>
                    </ol>
                    
                    <h3>Kasus Khusus: Mr. White</h3>
                    <p>Jika Mr. White yang terpilih untuk dieliminasi, dia tidak langsung kalah! Dia mendapat <strong>satu kesempatan</strong> untuk menebak kata rahasia milik Civilian.
                    <ul>
                        <li>Jika tebakannya <strong>benar</strong>, Mr. White langsung memenangkan permainan! Semua pemain lain yang tersisa akan mendapat hukuman Truth or Dare.</li>
                        <li>Jika tebakannya <strong>salah</strong>, Mr. White tereliminasi dan permainan berlanjut.</li>
                    </ul>

                    <h3>Kondisi Kemenangan</h3>
                    <ul>
                        <li><strong>Tim Civilian Menang</strong> jika berhasil mengeliminasi semua Undercover dan Mr. White.</li>
                        <li><strong>Tim Undercover & Mr. White Menang</strong> jika jumlah mereka sudah sama atau lebih banyak dari jumlah Civilian yang tersisa.</li>
                        <li><strong>Mr. White Menang (Instan)</strong> jika berhasil menebak kata Civilian saat dieliminasi.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="mass-penalty-modal" class="modal hidden">
            <div class="modal-content elimination-popup-content">
                <h3 id="mass-penalty-title"><i class="fas fa-gavel"></i> Babak Hukuman Tim Kalah! <i class="fas fa-gavel"></i></h3>
                <p>Mr. White menang! Pemain berikut harus menerima hukuman:</p>
                <p>Giliran: <strong id="mass-penalty-player-name" style="font-size: 1.2em; color: var(--primary-color);"></strong></p>
                <div id="mass-truth-or-dare-section">
                    <p>Silakan pilih hukuman:</p>
                    <button id="mass-truth-btn"><i class="fas fa-check-circle"></i> Truth</button>
                    <button id="mass-dare-btn"><i class="fas fa-fire"></i> Dare</button>
                    <div id="mass-penalty-display" class="hidden">
                        <p id="mass-penalty-text"></p>
                    </div>
                </div>
                <button id="mass-penalty-next-btn" class="hidden btn-primary"><i class="fas fa-arrow-right"></i> Lanjut ke Pemain Berikutnya</button>
            </div>
        </div>

        <div id="winner-popup-modal" class="modal hidden">
            <div class="modal-content">
                <img id="confetti-animation" src="assets/images/confetti.gif" alt="Confetti" class="confetti-overlay hidden"/>
                <span class="close-popup-btn">&times;</span>
                <h2 id="popup-winner-message">ğŸ‰ Selamat! ğŸ‰</h2>
                <p id="popup-winner-detail"></p>
                <button id="proceed-to-round-scores-btn" class="btn-secondary"><i class="fas fa-trophy"></i> Lanjut ke Detail Babak</button>
            </div>
        </div>

        <div id="round-over-section" class="hidden">
            <h2 id="round-over-title"><i class="fas fa-flag-checkered"></i> Babak Selesai!</h2>
            <div id="round-summary">
                <div id="round-roles-section">
                    <h3><i class="fas fa-scroll"></i> Detail Peran & Skor Babak Ini:</h3>
                    <ul id="round-roles-list"></ul>
                </div>
            </div>
            <div id="next-actions-section">
                <button id="play-new-round-btn" class="btn btn-primary"><i class="fas fa-redo-alt"></i> Main Babak Baru</button>
                <button id="finish-game-show-final-scores-btn" class="btn btn-secondary"><i class="fas fa-stop-circle"></i> Selesai & Lihat Skor</button>
                <button id="restart-game-full-btn" class="btn btn-danger-text"><i class="fas fa-fast-backward"></i> Ulang Dari Awal</button>
            </div>
        </div>

        <div id="final-score-display-section" class="modal hidden">
             <div class="modal-content">
                <span class="close-final-score-btn">&times;</span>
                <h2><i class="fas fa-star"></i> Skor Akhir Permainan <i class="fas fa-star"></i></h2>
                
                <div class="table-responsive-wrapper">
                    <table id="final-score-table">
                        <thead>
                            <tr>
                                <th>Peringkat</th>
                                <th>Nama Pemain</th>
                                <th>Peran Asli</th>
                                <th>Total Skor</th>
                            </tr>
                        </thead>
                        <tbody id="final-cumulative-scores-list">
                            </tbody>
                    </table>
                </div>

                <button id="restart-from-final-btn" class="btn-secondary"><i class="fas fa-undo"></i> Ulang Dari Awal</button>
            </div>
        </div>

        <div id="music-settings-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-popup-btn">&times;</span>
                <h2><i class="fas fa-volume-up"></i> Pengaturan Musik Latar</h2>
                <div class="config-item">
                    <label for="music-selection">Pilih Musik:</label>
                    <select id="music-selection">
                        <option value="-1">Acak (Ganti Otomatis)</option>
                        <option value="0" selected>Detektif Malam</option>
                        <option value="1">Misi Rahasia</option>
                        <option value="2">Pesta Topeng</option>
                    </select>
                </div>
                <button id="confirm-music-btn" class="btn-primary"><i class="fas fa-check"></i> Terapkan Musik</button>
            </div>
        </div>

        <div id="peek-player-select-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-popup-btn">&times;</span>
                <h2><i class="fas fa-user-check"></i> Pilih Nama Anda</h2>
                <p>Pilih nama Anda dari daftar untuk melihat kartu Anda kembali.</p>
                <div class="config-item">
                    <label for="peek-player-select">Pemain:</label>
                    <select id="peek-player-select">
                        </select>
                </div>
                <button id="confirm-peek-btn" class="btn-primary"><i class="fas fa-arrow-right"></i> Tampilkan Kartu</button>
            </div>
        </div>
        
        <div class="developer-info">
            <p>Developed by Hamdi Rizal</p>
            <p>Feedback & Kontak:
                <a href="https://wa.me/6282286149127" target="_blank">WA: 0822-8614-9127</a> |
                <a href="https://instagram.com/hamdirzl" target="_blank">IG: @hamdirzl</a>
            </p>
            <p>Support Team: <a href="https://instagram.com/mhaafizz" target="_blank">IG: @mhaafizz</a></p>
        </div>
    </div>

    <audio id="background-music"></audio>
    <script src="script.js"></script>
</body>
</html>